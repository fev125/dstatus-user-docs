# DStatus 使用说明

## 简介
DStatus 是一个分布式服务器监控系统，用于监控服务器运行状态和性能指标。由客户端（agent）和服务器端组成，agent负责数据收集，服务器端负责存储和展示。

## 添加服务器

### 1. 自动发现
登录管理后台 → 自动发现 → 生成注册密钥。

**配置选项**：
- **需要密钥**：启用后，agent需提供有效密码注册
- **需要审核**：启用后，节点需管理员审核才能加入服务器列表

**可选功能**：
- **主动上报**：agent主动推送数据给面板
- **自定义端口**：设置通讯端口（默认19999）

**注意**：
- 确保agent能与面板通讯
- 重新注册需先执行卸载命令
- 安装/更新/卸载命令在[命令]按钮中查看

### 2. 手动添加
服务器管理 → 新增服务器 → 填写SSH信息（地址、账号、密码）→ 保存 → 安装/更新探针。

**卸载**：
编辑节点 → 点击卸载命令 → 可选择删除服务器记录。

## 特殊场景配置

### NET主机安装
修改通讯端口为外部可访问端口（如19999），确保防火墙放行该端口。修改后重新安装探针。

### 无公网IP配置
**方案1**：使用内网穿透工具（如frp）确保服务器可外部访问。

**方案2**：自动发现中的主动上报模式。

**注意**：无有效端口且开启主动模式时，该节点无法监控其他目标服务器。

### ix 机器配置

ix 机器安装探针后，根据是否需要网络质量监控有两种配置方式：

#### 不需要网络质量监控
- **选择主动模式**：在自动发现页面启用"主动上报"模式，或者编辑服务器页面开启主动模式
- 域名/IP 填写 ix 的海外 IP
- 落地IP：留空即可（仅用于流媒体解锁检测，此场景不需要）
- 探针正常收集性能数据，但无法进行网络质量检测

#### 需要使用网络质量监控
- 使用可以与 VPS 通信的服务器转发通信端口（API端口，默认9999）
- 域名/IP 填写转发机器的 IP（不是 ix 的海外 IP）
- 落地IP：留空即可（仅用于流媒体解锁检测，不影响网络质量监控）
- 转发端口需要和 API端口一致（例如：API端口9999，转发端口也必须是9999）

#### 安装方式
- 转发 22 端口通过网页在线安装：在SSH配置中填写转发机器的IP和端口，通过转发连接安装探针
- 使用自动发现功能安装：在自动发现页面生成注册密钥，在ix机器上执行安装命令

#### 重要说明
- 通信端口（API端口）用于服务器与探针通信
- 被动模式：必须开放通信端口，服务器定期查询探针数据
- 主动模式：默认不需要开放通信端口；但如需网络质量检测，仍需开放通信端口以调用 `/tcping` 接口
- 网络质量监控功能需要服务器能够访问探针的通信端口以调用 `/tcping` 接口
- 如果ix机器无法直接访问VPS，需要通过转发服务器桥接通信
- **落地IP字段说明**：落地IP仅用于流媒体解锁检测功能（IP质量检测），不影响性能监控、网络质量监控等其他功能

## 常见问题
- **NET主机安装**：修改通讯端口并确保防火墙放行
- **无法更新探针**：检查网络连接和SSH权限
- **无法删除探针**：执行完整卸载命令后手动删除服务器记录
