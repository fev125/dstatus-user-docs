# 使用指南

快速上手 DStatus 分布式服务器监控系统。

## 快速开始

### 添加服务器

#### 方式一：自动发现（推荐）
1. 管理后台 → **自动发现** → 生成注册密钥
2. 在目标服务器执行安装命令（页面自动生成）
3. 服务器自动注册（可选审核）

**配置选项：**
- 需要密钥：启用后需提供密码注册
- 需要审核：启用后需管理员审核
- 主动上报：agent 主动推送数据（适合无公网 IP）
- 自定义端口：修改通讯端口（默认 9999）

#### 方式二：手动添加
1. 管理后台 → **服务器管理** → 新增服务器
2. 填写 SSH 信息（IP、端口、用户名、密码）
3. 测试连接 → 保存 → 安装探针

**卸载：** 编辑节点 → 卸载命令 → 删除记录

## 特殊场景配置

### NAT 主机
- 修改通讯端口为外部可访问端口（如 9999）
- 确保防火墙放行该端口
- 重新安装探针

### 无公网 IP
**方案 1：** 使用内网穿透（如 frp）

**方案 2：** 启用主动上报模式

⚠️ **注意：** 主动模式下无法监控其他目标服务器的网络质量

### ix 机器

#### 仅性能监控
- 启用主动上报模式
- 域名/IP：填写 ix 的海外 IP
- 落地 IP：留空

#### 性能 + 网络质量监控
- 使用转发服务器转发通信端口（API 端口，默认 9999）
- 域名/IP：填写转发机器的 IP
- 转发端口必须与 API 端口一致

**安装方式：**
- 转发 SSH 端口在线安装
- 或使用自动发现功能安装

## 通知配置

### Telegram 通知
1. 获取 Bot Token（@BotFather）
2. 获取 Chat ID（@getidbot）
3. 通知设置 → 填写配置 → 测试通知

### 邮件通知
1. 通知设置 → 配置 SMTP 服务器
2. 填写发件人和收件人信息
3. 测试通知验证

## 常见问题

### 服务器显示离线
1. 检查网络连通性
2. 检查探针进程：`ps aux | grep dstatus`
3. 检查防火墙是否放行通讯端口（默认 9999）
4. 重新执行安装命令

### 数据更新不及时
1. 点击刷新按钮手动更新
2. Ctrl+F5 强制刷新页面
3. 检查浏览器控制台 WebSocket 错误

### 无法添加服务器
1. 确认 SSH 用户名和密码正确
2. 确认 SSH 端口正确（默认 22）
3. 测试连接：`ssh username@ip -p port`
4. 检查防火墙是否允许 SSH 连接

### 通知不发送
1. 重新获取 Bot Token 和 Chat ID
2. 使用"测试通知"功能验证
3. 确保服务器能访问 Telegram API

## 安全建议

- ✅ 首次登录后修改默认密码
- ✅ 启用两步验证（2FA）
- ✅ 定期备份数据库和配置
- ✅ 及时更新到最新版本

## 移动端使用

1. 移动浏览器访问监控页面
2. 浏览器菜单 → "添加到主屏幕"
3. 安装 PWA 应用

---

💡 **提示：** 更多详细配置请查看各专题文档
