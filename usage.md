# 使用指南（安装后怎么“加节点并跑通”）

这份文档只解决一件事：**装完面板后，你下一步怎么把被控机加进来，并确认它真的在上报数据。**

## 先跑通闭环（3 步）

1. 你能打开面板（见：[快速开始](/quick-start)）
2. 你能把 1 台被控机加进来并安装 Agent（下面两种方式选一种）
3. 你能在“服务器管理（`/admin/servers`）”里看到这台节点变为在线，并持续刷新数据

## 添加节点（两种方式，选一种）

### 方式 A：自动发现（推荐，适合批量）

1. 管理后台 → 自动发现（`/admin/autodiscovery`）
2. 复制页面生成的安装命令，到被控机执行
3. 回到页面刷新：看到节点出现；如你开启了审核，点“批准”

### 方式 B：手动添加（适合只加 1-2 台）

1. 管理后台 → 服务器管理（`/admin/servers`）→ 新增服务器
2. 填写 SSH 连接信息并保存
3. 按提示安装 Agent

## 模式怎么选（重点：你网络到底通不通）

系统里主要就两种模式：**被动模式（默认）**、**主动上报模式**。你只需要按“哪一端能连哪一端”来选。

| 你遇到的情况 | 推荐模式 | 你需要满足什么 |
| --- | --- | --- |
| 面板能直接访问被控机（能连到通信端口） | 被动模式 | 面板 → 被控机通信端口可达（默认 `9999`） |
| 被控机在内网/没公网，面板打不进来 | 主动上报 | 被控机 → 面板地址可达（面板端口默认 `5555`） |
| 两边都不通（出站也被限制/只能特定端口/只能 IPv6 但对端不通） | 先别纠结模式 | 先把网络打通（端口放行/转发/你自己的中继方案），再回到上面两行选模式 |

### 常见网络限制怎么处理（按你能做到的选）

- **没有公网 IP / 不能开入站端口**：优先用“主动上报”，只要被控机能访问面板地址即可。
- **只允许少数出站端口**：确保面板运行在你允许的端口（默认 `5555` 只是默认值），否则主动上报也连不上。
- **只有 IPv6**：不管被动还是主动，关键都是“双方是否真的能互相访问到对方”；如果对端网络不通，先解决连通性再选模式。
- **必须靠中继/穿透**：DStatus 不会替你“自动打洞”；你需要先用你自己的方式把网络打通，然后再回到上面的模式选择。

补充两句（容易踩坑）：

- 安装命令里会从 `down.vps.mom` 下载脚本/资源，这是正常的；下载不了就会导致“节点没出现”。
- 如果你要用“网络质量监控”（`/network-quality`），通常需要让参与检测的节点能被面板直连（更适合用被动模式，详见：[网络监控配置](/monitor)）。

## 常见问题（先按这个顺序查）

### 1) 节点没出现

因为安装命令没执行成功，所以面板收不到注册信息。

- 回到“服务器管理/自动发现”，重新复制一次安装命令再执行
- 确认被控机能访问 `down.vps.mom`（安装资源从这里下载）

### 2) 节点出现了但离线/数据不刷新

因为面板拿不到 Agent 的数据，所以会显示离线或不更新。

- 被动模式：确认通信端口可达并放行（默认 `9999`）
- 主动上报：确认被控机能访问面板地址（默认 `5555`），再检查上报配置

更完整的排查清单见：[Agent 使用指南](/agent-guide)

### 3) 面板打不开

因为端口没放行或端口被占用，所以浏览器访问失败。

- 确认你访问的是正确端口（默认 `5555`，除非你自定义过）
- 确认服务器安全组/防火墙已放行该端口

## 你可能需要的页面

- 页面总览：[页面总览](/pages-overview)
- 网络质量监控：[网络监控配置](/monitor)（配置）与 `/network-quality`（查看）
