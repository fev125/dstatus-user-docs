# 服务器管理页面

## 页面路径
管理后台 → 服务器管理（`/admin/servers`）

## 页面功能
- 查看服务器列表（支持分页和搜索）
- 添加新服务器
- 编辑服务器配置
- 删除服务器及其数据
- 清理孤立数据
- 调整服务器排序

## 主要操作

### 查看服务器列表
- **搜索**：在搜索框输入服务器名称、主机或标签进行筛选
- **分页**：使用底部分页控制器切换页面
- **排序**：拖拽服务器卡片调整显示顺序，点击"保存"按钮保存排序

### 添加服务器
1. 点击"新增服务器"按钮
2. 填写基本信息（名称、IP、SSH端口等）
3. 配置SSH连接（用户名、密码或密钥）
4. 选择分组和节点权限
5. 保存后点击"安装探针"部署监控程序

### 编辑服务器
1. 点击服务器卡片右侧的"编辑"按钮
2. 修改基本信息、SSH配置或监控设置
3. 点击"保存"应用更改

### 删除服务器
1. 点击服务器卡片右侧的"删除"按钮
2. 查看将删除的数据统计（流量、负载、监控数据等）
3. 确认删除操作
4. 系统自动删除服务器及其所有相关数据

### 清理孤立数据
- **功能**：清理因服务器删除后残留的孤立数据
- **使用**：点击"清理"按钮 → 查看统计 → 确认清理
- **作用**：清理不存在对应服务器的数据（流量、负载、监控等12个数据表）
- **注意**：操作不可恢复，清理前会显示统计信息供确认

### 重置流量数据
1. 进入服务器编辑页面
2. 找到"流量管理"区域
3. 点击"重置流量"按钮
4. 确认后清空该服务器的历史流量记录

## 节点权限说明
- **公开**：服务器正常监控且对外展示
- **私有**：服务器正常监控但仅管理员可见
- **停用**：停止监控数据收集，不参与监控

## 通信模式说明

### 被动模式（默认） {#被动模式默认}
- **工作原理**：服务器主动查询探针，探针被动等待服务器请求
- **通信方式**：服务器定期访问探针的 `/stat` API接口获取数据（轮询间隔由系统设置中的"监控轮询间隔"配置决定，可在高级设置页面修改）
- **端口要求**：必须开放通信端口（API端口，默认9999），允许服务器访问
- **适用场景**：服务器可以直接访问探针的网络环境
- **离线检测**：通过查询失败判断节点是否离线

### 主动模式
- **工作原理**：探针主动向服务器上报数据，服务器被动接收
- **通信方式**：探针定期向服务器的 `/stats/update` 接口推送数据
- **端口要求**：默认不需要开放通信端口；但如需使用网络质量检测功能，仍需开放通信端口
- **适用场景**：探针在内网或防火墙后，服务器无法直接访问探针的场景
- **离线检测**：通过心跳机制判断，超过阈值时间未收到上报则判定为离线（动态阈值，基于心跳均值）

**切换方式**：在服务器编辑页面，找到"通讯模式"选项，切换主动/被动模式

## 常见问题

### 服务器无法连接
- 检查SSH端口和防火墙设置
- 验证用户名和密码正确性
- 确保SSH用户有sudo权限

### 数据不更新
- 检查探针是否正常运行
- 验证服务器网络连通性
- 点击刷新按钮手动更新

### 清理孤立数据 {#清理孤立数据-1}
- 孤立数据通常由服务器删除时未完全清理产生
- 定期清理可优化数据库性能
- 清理前会显示各表的孤立数据数量

