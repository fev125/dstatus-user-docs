# 服务器管理（添加/安装 Agent）

## 入口

管理后台 → 服务器管理（`/admin/servers`）

## 你会在这里做的事

- 新增服务器：把一台被控机加入监控
- 安装/卸载 Agent：面板会生成命令，你复制到被控机执行
- 调整通信模式：被动（面板主动拉取）/ 主动上报（面板无法直连时使用）
- 删除服务器：同时清理对应数据

## 新增服务器（最短路径）

1. 点“新增服务器”
2. 填写 SSH 连接信息（主机名/端口/账号等）
3. 保存后，按提示点“安装探针（Agent）”

## 通信模式怎么选

### 被动模式（默认）

因为面板需要直接访问被控机的通信端口，所以你要确保端口可达且放行。

- 端口：以你的配置为准；面板默认 `9999`
- 适用：被控机有公网可达地址，或你做了端口转发/内网穿透

### 主动模式（主动上报）

因为被控机主动把数据推给面板，所以通常不需要让面板“打进来”访问端口。

- 适用：被控机在内网/NAT 后，面板无法直连
- 注意：部分需要“面板直连 Agent”的功能会受影响（例如网络质量检测）

## 常见问题

### SSH 连接失败

- 因为 SSH 端口/账号信息不对，所以连接会失败：先确认端口、账号、认证方式
- 因为防火墙没放行，所以连不上：先放行 SSH 端口再试

### 数据不更新/显示离线

优先按 Agent 排障清单一步步查（见：/agent-guide）。
