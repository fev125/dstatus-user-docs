# 面板迁移教程

本文用于把旧机器上的 DStatus 面板迁移到新机器，并尽量保留你的配置与数据。

## 迁移前准备

- 确保你能登录旧面板和新面板的管理员账号。
- 部署入口在 `https://client.vps.mom`，安装脚本会从 `down.vps.mom` 拉取资源（新机器需要能访问该域名）。

## 方案 A（推荐）：面板内备份 + 恢复

适合大多数用户，操作简单，出错概率低。

### A1. 在旧面板导出备份

1. 登录旧面板后台。
2. 打开「高级设置」页面：`/admin/advanced-settings`。
3. 在「数据库管理」卡片点击「下载压缩备份（gzip）」并保存到本地。

如果你只想迁移“配置 + 节点列表”，不需要迁移历史监控数据，可以下载「轻量备份」。

### A2. 在新面板恢复备份

1. 在新机器按 `client.vps.mom` 的部署流程安装并启动面板。
2. 登录新面板后台 → 打开 `/admin/advanced-settings`。
3. 在「数据库管理」卡片点击「恢复数据库」，上传你在旧面板下载的备份文件。
4. 等待恢复完成（恢复过程中页面可能会短暂断开或需要刷新）。
5. 刷新页面后重新登录，检查节点列表/分组/通知等是否正常。

## 方案 B（备选）：只拷贝数据目录

适合你无法在面板内上传备份文件，或者更习惯用 SSH 操作。

说明：默认情况下，面板的核心数据与配置都在 `data` 目录内（例如数据库文件），迁移 `data` 即可完成主要迁移。

### B1. 停止旧面板

在旧机器执行其一即可：

- `systemctl stop dstatus`
- 或进入安装目录后执行：`docker-compose down`

### B2. 拷贝 data 目录到新机器

默认安装目录是 `/opt/dstatus`，需要迁移的目录是：

- 旧机器：`/opt/dstatus/data`
- 新机器：`/opt/dstatus/data`

示例（在新机器执行）：

```bash
rsync -avz root@OLD_HOST:/opt/dstatus/data/ /opt/dstatus/data/
```

如果你安装时改过 `--install-dir`，请把路径替换成你的实际安装目录。

### B3. 启动新面板并验证

在新机器执行其一即可：

- `systemctl start dstatus`
- 或进入安装目录后执行：`docker-compose up -d`

打开新面板，确认节点列表、分组、通知等数据已迁移成功。

## 常见问题

### 1) 迁移后需要重新登录吗？

通常需要。恢复数据库后，登录信息会以你备份时的状态为准。

### 2) 迁移后地址/端口变了怎么办？

如果你对外访问使用域名或反向代理，需要把域名解析/代理配置指向新机器的面板地址与端口。
